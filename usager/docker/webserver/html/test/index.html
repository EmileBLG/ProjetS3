

<!DOCTYPE html>

<head>

    <meta charset="UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <title>Ligues intra-muros UDS</title>



    <style>

        .grille {

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));

            grid-gap: 10px;

        }



    </style>



    <link rel="stylesheet" href="style.css">



    <!--    <link rel="preconnect" href="https://fonts.googleapis.com">-->

    <!--    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>-->

    <!--    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700&display=swap" rel="stylesheet">-->

    <!--    <style>-->

    <!--        body {-->

    <!--            font-family: 'Roboto Slab', serif;-->

    <!--            font-weight: bold;-->

    <!--        }-->

    <!--    </style>-->

    <script src="http://localhost:8180/js/keycloak.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src=".\script.js"></script>

    <script>

        var keycloak;

        function initKeycloak() {

            keycloak = new Keycloak({

                "realm": "usager",

                "auth-server-url": "http://localhost:8180/",

                "ssl-required": "external",

                "clientId": "frontend",

                "public-client": true,

                "confidential-port": 0

            });

            keycloak.init({onLoad: 'login-required'}).then(function (authenticated) {

                alert(authenticated ? 'authenticated' : 'not authenticated');



            }).catch(function () {

                alert('failed to initialize');

            });

        }



        function requestStudent() {

            const div = document.getElementById('content');

            const span = div.firstElementChild;

            axios.get("http://localhost:8888/api/student", {

                headers: {

                    'Authorization': 'Bearer ' + keycloak.token

                }

            })

                .then(function (response) {

                    console.log("Response: ", response.status);

                    content.innerHTML = '<br> <strong>' + response.data.cip + '</strong> </br>' +

                        '<br> <strong>' + response.data.last_name + '</strong> </br>' +

                        '<br> <strong>' + response.data.first_name + '</strong> </br>' +

                        '<br> <strong>' + response.data.email + '</strong> </br>' +

                        '<br> <strong>' + response.data.roles + '</strong> </br>'

                })

                .catch(function (error) {

                    console.log('refreshing');

                    keycloak.updateToken(5).then(function () {

                        console.log('Token refreshed');

                    }).catch(function () {

                        console.log('Failed to refresh token');

                    })

                });

            content.innerHTML = '<br> <strong>' + "Vous n'avez pas le role d'étudiant" + '</strong> </br>'

        }



        function horairePersonnel(){

            axios.get("http://localhost:8888/api/horaire", {

                headers: {

                    'Authorization': 'Bearer ' + keycloak.token

                }

            })

                .then(function (response) {

                    console.log("Response: ", response);

                    affichageHorairePersonnel(response);

                })

                .catch(function (error) {

                    console.log('refreshing');

                    keycloak.updateToken(5).then(function () {

                        console.log('Token refreshed');

                    }).catch(function () {

                        console.log('Failed to refresh token');

                    })

                });

        }



        function listeMatch(){

            axios.get("http://localhost:8888/api/horaire", {

                headers: {

                    'Authorization': 'Bearer ' + keycloak.token

                }

            })

                .then(function (response) {

                    console.log("Response: ", response);

                    console.log("on est juste avant affichage grill")

                    affichageGrill(response);

                })

                .catch(function (error) {

                    console.log('refreshing');

                    keycloak.updateToken(5).then(function () {

                        console.log('Token refreshed');

                    }).catch(function () {

                        console.log('Failed to refresh token');

                    })

                });

        }

        function getEtatPresence(matchId, elementParent, matchObjet){
            axios.get("http://localhost:8888/api/getetatpresence"+"?matchId=" + matchId, {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response);
                    console.log("on est juste avant affichage grill")
                    // affichageGrill(response); a changer
                    widgetPresenceMatchSuite(elementParent, matchObjet, response)
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
        }

        function tokentPresent(matchId){



            axios.get("http://localhost:8888/api/setPresent/"+"?matchId="+matchId.toString(), {

                headers: {

                    'Authorization': 'Bearer ' + keycloak.token

                }

            })

                .then(function (response) {

                    console.log("Response: ", response);

                    console.log("presence envoyer")

                    affichageGrill(response);

                })

                .catch(function (error) {

                    console.log('refreshing');

                    keycloak.updateToken(5).then(function () {

                        console.log('Token refreshed');

                    }).catch(function () {

                        console.log('Failed to refresh token');

                    })

                });

        }



        function tokentAbsent(matchId){



            axios.get("http://localhost:8888/api/setAbsent/"+"?matchId="+matchId.toString(), {

                headers: {

                    'Authorization': 'Bearer ' + keycloak.token

                }

            })

                .then(function (response) {

                    console.log("Response: ", response);

                    console.log("absence envoyer")

                    affichageGrill(response);

                })

                .catch(function (error) {

                    console.log('refreshing');

                    keycloak.updateToken(5).then(function () {

                        console.log('Token refreshed');

                    }).catch(function () {

                        console.log('Failed to refresh token');

                    })

                });

        }
        function quitter(){
            window.location.href= '../intra-muro/';
        }
    </script>

    </head>
<body style="background-color:  white;" onload="initKeycloak(), affichageBouton()">
    <header id="header" class="header">
        <div class="container">
            <img src=".\images\UdeS_logo_h_rgbLR.png" style="width: 215px; height: 75px;">
            <h1 class="titre">
                <a href="index.html">
                    Ligues intra-muros UDS
                </a>
            </h1>
            <button class="buttonTitre" onclick="quitter()">Déconnexion</button>
            <!-- <button class="button-option" onclick=""-->


        </div>
    </header>

    


<div id="sidebar" class="sidebar">



    <nav>

        <ul id="liste-bouton">





        </ul>

    </nav>

</div>



<div id="content" class="content" >



    <div style="display: flex; justify-content: center; align-items: center;">

        <img src=".\images\Entete_page_intra-muros.jpg" width="100%">

    </div>



</div>









</body>



</html>