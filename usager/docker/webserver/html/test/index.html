<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ligues intra-muros UDS</title>

    <link rel="stylesheet" href="style.css">

    <script src="http://localhost:8180/js/keycloak.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src=".\script.js"></script>
    <script>
        var keycloak;
        function initKeycloak() {
            keycloak = new Keycloak({
                "realm": "usager",
                "auth-server-url": "http://localhost:8180/",
                "ssl-required": "external",
                "clientId": "frontend",
                "public-client": true,
                "confidential-port": 0
            });
            keycloak.init({onLoad: 'login-required'}).then(function (authenticated) {
                alert(authenticated ? 'authenticated' : 'not authenticated');

            }).catch(function () {
                alert('failed to initialize');
            });
        }

        function requestStudent() {
            const div = document.getElementById('content');
            const span = div.firstElementChild;
            axios.get("http://localhost:8888/api/student", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response.status);
                    content.innerHTML = '<br> <strong>' + response.data.cip + '</strong> </br>' +
                        '<br> <strong>' + response.data.last_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.first_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.email + '</strong> </br>' +
                        '<br> <strong>' + response.data.roles + '</strong> </br>'
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
            content.innerHTML = '<br> <strong>' + "Vous n'avez pas le role d'étudiant" + '</strong> </br>'
        }
    </script>

</head>
<body style="background-color:  white;" onload="">
    
        <header id="header">
            <div class="container">
                <img src=".\images\UdeS_logo_h_rgbLR.png" style="width: 215px; height: 75px;">
                <h1 class="titre">
                    <a href="index.html">
                        Ligues intra-muros UDS
                    </a>
                </h1>
                <button class="buttonTitre" onclick="initKeycloak()">Connexion</button>

            </div>
        </header>

        <div id="sidebar" class="sidebar">
            <h2 style="margin-left: 20px;">
                Sport
            </h2>
            <nav>
                <ul>
                    <li>
                        <div class="menu">
                            <button class="menu-trigger">Balle-donnée</button>
                            <div class="options">
                                <button class="option" onclick="affichageHoraireClassement(1, 1)">A</button>
                                <button class="option" onclick="affichageHoraireClassement(1, 2)">B</button>
                                <button class="option" onclick="affichageHoraireClassement(1, 3)">C</button>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="menu">
                            <button class="menu-trigger">Balle-molle</button>
                            <div class="options">
                                <button class="option" onclick="affichageHoraireClassement(2, 1)">A</button>
                                <button class="option" onclick="affichageHoraireClassement(2, 2)">B</button>
                                <button class="option" onclick="affichageHoraireClassement(2, 3)">C</button>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="menu">
                            <button class="menu-trigger">Soccer extérieur</button>
                            <div class="options">
                                <button class="option" onclick="affichageHoraireClassement(3, 1)">A</button>
                                <button class="option" onclick="affichageHoraireClassement(3, 2)">B</button>
                                <button class="option" onclick="affichageHoraireClassement(3, 3)">C</button>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="menu">
                            <button class="menu-trigger">Spikeball</button>
                            <div class="options">
                                <button class="option" onclick="affichageHoraireClassement(4, 1)">A</button>
                                <button class="option" onclick="affichageHoraireClassement(4, 2)">B</button>
                                <button class="option" onclick="affichageHoraireClassement(4, 3)">C</button>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="menu">
                            <button class="menu-trigger">Ultimate frisbee extérieur</button>
                            <div class="options">
                                <button class="option" onclick="affichageHoraireClassement(5, 1)">A</button>
                                <button class="option" onclick="affichageHoraireClassement(5, 2)">B</button>
                                <button class="option" onclick="affichageHoraireClassement(5, 3)">C</button>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="menu">
                            <button class="menu-trigger">Volleyball de plage</button>
                            <div class="options">
                                <button class="option" onclick="affichageHoraireClassement(6, 1)">A</button>
                                <button class="option" onclick="affichageHoraireClassement(6, 2)">B</button>
                                <button class="option" onclick="affichageHoraireClassement(6, 3)">C</button>
                            </div>
                        </div>

                    </li>
                    <li>
                        <button class="button-option" onclick="requestStudent()">Horaire</button>
                    </li>
                    <li>
                        <button class="button-option" onclick="requestStudent()">Présence</button>
                    </li>
                </ul>
            </nav>
        </div>

        <div id="content" class="content" >
            <table id="horaire"></table>

        </div>
</body>
</html>