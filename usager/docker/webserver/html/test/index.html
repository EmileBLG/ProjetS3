<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Ligues intra-muros UDS</title>

    <style>
        .grille {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            grid-gap: 10px;
        }

    </style>

    <link rel="stylesheet" href="style.css">

    <script src="http://localhost:8180/js/keycloak.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src=".\script.js"></script>
    <script>
        var keycloak;
        function initKeycloak() {
            keycloak = new Keycloak({
                "realm": "usager",
                "auth-server-url": "http://localhost:8180/",
                "ssl-required": "external",
                "clientId": "frontend",
                "public-client": true,
                "confidential-port": 0
            });
            keycloak.init({onLoad: 'login-required'}).then(function (authenticated) {
                alert(authenticated ? 'authenticated' : 'not authenticated');

            }).catch(function () {
                alert('failed to initialize');
            });
        }

        function requestStudent() {
            const div = document.getElementById('content');
            const span = div.firstElementChild;
            axios.get("http://localhost:8888/api/student", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response.status);
                    content.innerHTML = '<br> <strong>' + response.data.cip + '</strong> </br>' +
                        '<br> <strong>' + response.data.last_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.first_name + '</strong> </br>' +
                        '<br> <strong>' + response.data.email + '</strong> </br>' +
                        '<br> <strong>' + response.data.roles + '</strong> </br>'
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
            content.innerHTML = '<br> <strong>' + "Vous n'avez pas le role d'Ã©tudiant" + '</strong> </br>'
        }

        function affichageHorairePersonnel(){
            axios.get("http://localhost:8888/api/horaire", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response);
                    affichageHoraire(response);
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
        }

        function listeMatch(){
            axios.get("http://localhost:8888/api/horaire", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
                .then(function (response) {
                    console.log("Response: ", response);
                    console.log("on est juste avant affichage grill")
                    affichageGrill(response);
                })
                .catch(function (error) {
                    console.log('refreshing');
                    keycloak.updateToken(5).then(function () {
                        console.log('Token refreshed');
                    }).catch(function () {
                        console.log('Failed to refresh token');
                    })
                });
        }
    </script>

</head>
<body style="background-color:  white;" onload="affichageBouton()">
    
        <header id="header">
            <div class="container">
                <img src=".\images\UdeS_logo_h_rgbLR.png" style="width: 215px; height: 75px;">
                <h1 class="titre">
                    <a href="index.html">
                        Ligues intra-muros UDS
                    </a>
                </h1>
                <button class="buttonTitre" onclick="initKeycloak()">Connexion</button>

            </div>
        </header>

        <div id="sidebar" class="sidebar">
            <h2 style="margin-left: 20px;">
                Sport
            </h2>
            <nav>
                <ul id="liste-bouton">


                </ul>
            </nav>
        </div>

        <div id="content" class="content" >

            <div style="display: flex; justify-content: center; align-items: center;">
                <img src=".\images\Entete_page_intra-muros.jpg" width="100%">
            </div>

        </div>






</body>

</html>